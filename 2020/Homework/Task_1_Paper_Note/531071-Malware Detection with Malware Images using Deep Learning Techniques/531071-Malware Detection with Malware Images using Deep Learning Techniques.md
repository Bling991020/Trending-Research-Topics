## 一 论文信息

标题:Malware Detection with Malware Images using Deep Learning Techniques

作者:[Ke He ](https://ieeexplore.ieee.org/author/37087102589); [Dong-Seong Kim](https://ieeexplore.ieee.org/author/37086886021)

出处及链接：[2019 18th IEEE International Conference On Trust, Security And Privacy In Computing And Communications/13th IEEE International Conference On Big Data Science And Engineering (TrustCom/BigDataSE)](https://ieeexplore.ieee.org/xpl/conhome/8883860/proceeding)

​                       https://ieeexplore.ieee.org/document/8887303

笔记作者昵称：Jinx

## 二 论文简要

​	    恶意软件检测系统（MDS）是抵御恶意攻击的第一道防线，因此，对于恶意软件检测系统而言，准确有效地检测恶意软件至关重要。传统的MDS通常利用传统的机器学习算法，这些算法需要进行特征选择和提取，这既费时又容易出错。而基于传统深度学习的方法通常使用递归神经网络（RNN），可能容易受到冗余API注入的影响。因此，该论文研究了卷积神经网络（CNN）对抗冗余API注入的有效性。作者设计了一个恶意软件检测系统，该系统将恶意软件文件转换为图像表示形式，并使用CNN对图像表示形式进行分类。CNN使用空间金字塔池层（SPP）来实现，以处理大小变化的输入。通过测量系统在未注入数据和对抗数据的情况下（注入冗余API）的性能来评估SPP和图像色彩空间（灰度/ RGB）的有效性。最终结果表明，由于内存限制，单纯的SPP实现是不切实际的，并且灰度成像可有效防止多余的API注入。

## 三 框图

```flow


op1=>operation: 预处理
-将原始输入的恶意软件文件
转化为灰度图像/RGB图像
op2=>operation: 分类
-使用恶意软件图像训练CNN
并通过SPP实现     
op3=>operation: 评估
-评估分类模型的准确性
op1->op2->op3

```

## 四 主要内容

#### **实验过程：**

**1 预处理**：预处理模块的主要目标是将原始输入的恶意软件文件转换为分类模块能够处理的值矩阵。转换输入文件的新颖，简单，有效的方法是将恶意软件源代码编译为二进制文件，然后将二进制文件转换为图像。每个字节的范围是0到255，因此它可以直接表示恶意软件的灰度图像中的一个像素。可以观察到，属于同一家族的恶意软件的灰度图像表现出相似的布局和纹理，并且已发现灰度图像可抵抗部分加密，这是一种流行的代码混淆技术。除此以外，还有另一种转换方法，可以将恶意软件文件转换为RGB图像。对于RGB图像，一组3个字节代表输出图像中的每个像素，分别对应于红色，绿色和蓝色通道。

**2 分类**：分类模块从预处理器获取转换后的图像，并使用该图像训练CNN或使用CNN评估图像。恶意软件文件的大小不同，但是，典型的CNN仅接受固定大小的输入。先前已经使用了各种方法，例如下采样，裁剪或扭曲以及截断输入。修改输入图像对于恶意软件检测不是理想的选择，因为它很容易在检测阶段丢失信息。攻击者可以将恶意代码故意放置在可能会在分类之前被删除的部分中，从而绕过检测系统。论文的解决方案是使用空间金字塔池（SPP）层，使CNN可以拍摄任何大小的图像。SPP层在最后一个卷积层和完全连接的层之间进行操作，并将最后一个卷积层的特征图划分为多个级别和多个子部分。每个级别中的每个子部分都经过最大池化以提取最主要的特征，并且每个特征都被连接到固定长度的输出数组中，以用于完全连接的层。SPP层允许神经网络获取任意大小的输入图像，并为完全连接的层输出固定大小的特征数组。

**3 评估**：评估模块使用分类模块将看不见的文件分类为恶意软件或良性文件，并评估分类器的准确性。CNN的输出是介于0和1之间的数字，表示文件被恶意（1）或良性（0）的可能性。这里引入了一个称为阈值的参数，以便将高于阈值的值视为恶意的，否则将是良性的。为了进行评估，该模块使用了其余10％的样本数据，并生成了混淆矩阵。从混淆矩阵中，可以计算准确性指标，例如准确性，召回率，误报率和f1得分。

#### 实验结果：

1   Resnet模型在RGB输入下效果更好，而简单的普通网络在灰度输入下效果更好。一个可能的解释是，尽管原始数据是相同的，但在RGB图像中，字节值就输入量而言在空间上彼此接近。这使诸如resnet50之类的更复杂的网络能够识别出导致高精度的复杂模式。这意味着，如果将第三维（颜色通道）扩展到三个以上，则使用复杂网络可以获得更好的检测结果。

2 ：由于输入图像大小的巨大差异，文中应用了空间金字塔池（SPP），图像大小的巨大使我们采用了自己的“分而治之”方法来减少内存限制。实验结果表明，SPP和“分而治之”的组合效果不佳。事后看来，原因很明显：划分步骤可能会将恶意软件功能分为多个部分，而CNN无法将其拆分为恶意软件功能。即使未分割恶意软件功能，仅拥有所有恶意软件功能的子集也不足以将输入分类为恶意。更好的策略可能是“划分并合并”，其中将子图像合并并合并回完整图像，而不是对子图像进行分类，然后再由CNN对其进行分类。

## 五 创新点

1、传统的MDS通常利用传统的机器学习算法，这些算法需要特征选择和提取，这既费时又容易出错。基于深度学习的MDS可以有效提高效率。

2、当前基于深度学习的恶意软件检测系统主要基于递归神经网络（RNN），但是，RNN可能容易受到对抗性攻击，注入了冗余API调用的文件可以轻松绕过RNN检测。在恶意软件检测中使用RNN的鲁棒性和有效性仍然值得怀疑。论文研究卷积神经网络（CNN）对冗余API注入的恢复能力，以弥补RNN的缺陷。

3、将恶意软件文件转换为图像表示形式，并使用CNN对图像表示形式进行分类。CNN使用空间金字塔池层（SPP）来实现，以处理大小变化的输入。

## 六 目前缺点

1、没有对数据进行交叉验证，理由是时间和资源的限制。训练大型数据集的神经网络十分费时，进行10倍交叉验证较为困难。

2、实验中的CNN模型未进行优化，没有尝试其他CNN架构。 多尝试几种CNN架构，并在其基础上进行微调可以得到更好的结果。

3、仅在二进制级别加入了冗余指令，而不是在代码级别。实际上在源代码级别添加冗余指令更为现实。

